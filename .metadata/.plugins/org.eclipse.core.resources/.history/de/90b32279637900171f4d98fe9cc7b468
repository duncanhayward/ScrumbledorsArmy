/**
 * 
 */
console.log('script was called')
var addCardBtn = 0;
var addTaskBtn = 0;


var app = angular.module("routePage", ["ngRoute", "ngDraggable"])
    .config(function($routeProvider) {
    $routeProvider
    .when("/", {
        templateUrl : "login.html",
        controller : "loginCtrl"
       
    })
    .when("/home", {
        templateUrl : "home.html",
        controller : "scrumPageCtrl"
    })
    .when("/login", {
        templateUrl : "login.html",
          controller : "loginCtrl"
    })
    .when("/register", {
        templateUrl : "register.html",
        controller : "registerCtrl"
    })
      .when("/scrumboard", {
        templateUrl : "dragDropEx.html",
        controller: 'scrumCtrl'	
    });
})

.config(['$locationProvider', function($locationProvider) {
  $locationProvider.hashPrefix('');
}])

.controller("registerCtrl", function($scope, $http, $location) {
	
	 $scope.changePageToLogin= function(){
			$location.path('/login');
		  }
	
	
})

.controller("scrumPageCtrl", function($scope, $http, $location) {
	 console.log('scrumCtrl callled');
	 $scope.changeToScrum= function(){
		
			$location.path('/scrumboard');
		  }
	
	
})

.controller("loginCtrl", function($scope, $http, $location) {
  var username = "jay";
  var password = "123";
  
  $scope.username = '';
  $scope.password = '';


  $scope.changePageToRegister= function(){
	$location.path('/register');
  }
 
  
  $scope.login = function() {
    console.log($scope.username);

    	var user= {
    		id: '0',
    		username: $scope.username,
    		password : $scope.password
    	};
    	
    	console.log('User->'+user.username);
    	console.log('id->'+user.id);
    	console.log('password->'+user.password);
    	
        $http({
            method: 'POST',
            url: 'http://localhost:8085/ScrumbledorsArmy/login',
            headers: {'Content-Type': 'application/json',  'Accept': 'application/json'},
//            data: user//user 
            data: user  
          }).then(function successCallback(response) 
            {
        		
        		$scope.response= JSON.stringify(response.data.username);
        		console.log('response.data->'+$scope.response);
            	console.log(response.status);
            	if(response.status!=200){
            		console.log('Login Failed!!')
            		
            	}
            	else {
            		console.log('Login Successfull');
            		$location.path('/home');
//            		 $('.login').css('display', 'none');
            	}
 
            }, function errorCallback(response) {
                // called asynchronously if an error occurs
                // or server returns response with an error status.
            	console.log('Not found');
//            	console.log(response);
        });

        console.log('User->'+user.username);
        
     
    }
})

.controller('scrumCtrl', function($scope, $compile){
	
	var colId = 1;
	var cardId = 0;
	

	$scope.message="HELLO";
	
	$scope.addElement= function(){
		console.log("scrumCtrl function called");
		
		var inputBox = angular.element("<input type='text' id='nameLane' placeholder='Enter Swim Lane Name' ng-keyup='nameLane()'/>");
		var lanename = $compile(inputBox)($scope);
		angular.element(addLanes).append(lanename);
	}
		
	$scope.nameLane= function(){
		console.log("name lane controller activated");
		
		if(event.keyCode==13){
		var newe = angular.element("<div class='column' id='div"+ colId++ + "' ng-drop='true' ><header>" + document.getElementById('nameLane').value +  "</header></div>");
		var newlane = $compile(newe)($scope);
		var target= document.getElementById("columns");
		angular.element(target).append(newlane);
		document.getElementById('nameLane').remove();
		
		if(addCardBtn == 0){
		var addCard = angular.element("<button class='btn btn-info' ng-click='writeStory()'>Add Card</button>");
		var card = $compile(addCard)($scope);
		angular.element(addLanes).append(card);
		addCardBtn = addCardBtn + 1;
			}
		}
	}
	
	$scope.writeStory= function(){
		console.log("write story controller activated");
		
		var userStory = angular.element("<textarea id='storyBox' placeholder='Enter Story Here' ng-keyup='addCard()'></textarea>");
		var story = $compile(userStory)($scope);
		angular.element(target).append(story);
	}
	
	$scope.addCard= function(){
		var storyCard = angular.element("<div class='card' id=" + cardId++ + " ng-drag='true' ng-Dblclick='addTask($event)'><div class='container-fluid'><p>" + document.getElementById('storyBox').value + "</p></div></div>");
		var stories = $compile(storyCard)($scope);
		
		if(event.keyCode == 13){
		angular.element(div1).append(stories);
		document.getElementById('storyBox').remove();
		}
	}
	
	$scope.addTask=function($event){
		console.log("double clicked!");
		
		var element = angular.element($event.target.parentNode.parentNode);
		console.log(element.attr("id"));
		
		var clicked = document.getElementById(element.attr("id"));
		
		console.log(clicked);
		
//		console.log(cardId);
		
		if(addTaskBtn == 0){
		var addTask = angular.element("<button class='btn btn-info' >Add Card</button> ");
		var tasks = $compile(addTask)($scope);
		
		angular.element(clicked).append(tasks);
		addTaskBtn = addTaskBtn + 1;
		}
	}
	
	
	
	
	
		
//	}
})

//.controller('lanenameCtrl', function($scope){
//	
//
//	
//})

//		var newe = angular.element("<div class='column'>{{name}}</div>");
//		var target= document.getElementById("columns");
//		angular.element(target).append(newe);
		
		
//		var newLane = document.createElement('div');
//		newLane.className = "column";
//		newLane.id = "div" + divCount++;
//		newLane.setAttribute("ondrop", "drop(event)");
//		newLane.setAttribute("ondragover", "allowDrop(event)");
//		newLane.setAttribute("draggable", "true");
//		
//		//creating header for column that will display swim lane name
//		newLaneHeader = document.createElement("header");
//		newLaneHeader.innerHTML = document.getElementById('lane_name').value;
//		
//		newLane.appendChild(newLaneHeader);
//		
//		document.getElementById('columns').appendChild(newLane);
//		document.getElementById('columns').removeChild(document.getElementById('lane_name'));
//		
//		//after a swim lane is on the board, you can begin adding cards (stories)
//		if (document.getElementById('addCard') == null){
//		createAddCardBtn();
//		}
		
		//with each swim lane added, update width of page to house all lanes without vertical scroll
//		updateWidth();
//	}
	
//})


